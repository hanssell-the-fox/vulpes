// result/result.ts

import Ok from "./ok.ts";
import Err from "./err.ts";

/**
 * Represents the *outcome* of some operation that ended in success (`Ok`) or a failure (`Err`).
 *
 * @template T Type of the success value.
 * @template E Type of the error value.
 */
export abstract class Result<T, E> {
  /**
   * Checks if it is a success.
   *
   * @returns `true` if it is `Ok`, otherwise `false`.
   */
  public abstract isOk(): this is Result<T, never>;

  /**
   * Checks if it is a failure.
   *
   * @returns `true` if it is `Err`, otherwise `false`.
   */
  public abstract isErr(): this is Result<never, E>;

  /**
   * Matches the type of the Result and executes the apropriate *handler* function.
   *
   * @param handlers - Object containing functions to be called on each variant of `Result`.
   * @returns Any value generated by the executed handler.
   */
  public abstract match<U>({ Ok, Err }: { Ok: (value: T) => U; Err: (value: E) => U }): U;

  /**
   * Applies `fn` to the contained value (if `Ok`), and returns the result as an `Ok`.
   *
   * @param fn - Function to apply to the contained success value.
   * @returns A new `Ok` containing the result of the function.
   */
  public abstract map<U>(fn: (value: T) => U): Result<U, E>;

  /**
   * Applies `fn` to the contained error value (if `Err`), and returns the result as an `Err`.
   *
   * @param fn - Function to apply to the contained error value.
   * @returns A new `Err` containing the result of the function.
   */
  public abstract mapErr<U>(fn: (value: E) => U): Result<T, U>;

  /**
   * Returns the contained success value or the provided *default* if it is an error.
   *
   * @param defaultValue - Value to be used in case of Err.
   * @returns The contained success value or the default.
   */
  public abstract or(defaultValue: T): T;

  /**
   * Returns the contained success value or throws an exception if `Err`.
   *
   * @returns The contained success value.
   */
  public abstract unwrap(): T | never;

  /**
   * Returns the contained error value or throws an exception if `Ok`.
   *
   * @returns The contained error value.
   */
  public abstract unwrapErr(): E | never;
}

export { Err, Ok };
